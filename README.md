# Rideau Canal Dashboard

## Overview

### Dashboard Features

- Real-time updates
- Charts and Visualizations
- Safety Status Indicators

### Technologies Used

- Node.js
- Express.js
- @azure/sdk
- chart.js

## Prerequisites

- Access to Azure Subscription to deploy resources
- Have the Python script running to generate data
- Deploy a CosmosDB
- Have the Azure Stream Analytics Job setup to ingest data from the IoT hub and output it into the database
- Node 20+

## Installation and Configuration

- `git clone https://github.com/demurphyh/rideau-canal-dashboard`
- `npm install`
- Add the Cosmos endpoint and Cosmoskey to the .env file (based off .env.example)
- Run the application
  - `node ./server.js`

## API Endpoints

```JS
/

/api/latest

api/history/:location

/api/status

/api/all

/health
```

- For more information refer to api-documentation.md

## Deployment to Azure App Service

### Step-by-step deployment guide

- Deploy Azure App Service through Azure Portal and specify node application
- Enter Environment variables for Cosmos endpoint and cosmos key
- Change this line in server.js to reflect the public url generated by App Service
  - `const API_BASE_URL = window.location.origin;`
- Deploy application through the github repository and create a new workflow in the repository.

### Configuration Settings

- Enter Environment variables for Cosmos endpoint and cosmos key
- Change this line in server.js to reflect the public url generated by App Service
  - `const API_BASE_URL = window.location.origin;`

## Dashboard Features

### Real-time updates

- Provides real time ice status updates(safe,caution,unsafe)
- Provide Ice Thickness, Surface Temperature and Snow Accumulation for Dow's Lake, Fifth Avenue, and NAC
- Data refreshes every 30 seconds.

### Charts and Visualizations

- Charts that autoupdate to display data for Ice Thickness and Temperature trends over the last hour

### Safety Status Indicators

- Safety status indicators (safe, caution, unsafe) depending on ice conditions

## Troubleshooting

### Common Issues and Fixes

- If using Node version > 20 you might face an error stating `Error fetching history: ReferenceError: crypto is not defined`

  - To fix this upgrade to the newest version of node
    - `nvm ls` to view newest node version
    - `nvm install` with the newest verision
    - `nvm use` with the newest version
  - After this the dashboard should run without issue
